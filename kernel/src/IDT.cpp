#include "IDT.h"
#include "int/isrTable.h"

#define IDT_ATTR(dpl) ((0x70 << 5) | (dpl & 3) << 13 | 1 << 15)

unsigned long long idt[256];
unsigned short idtLimit = sizeof(idt) - 1;

void setIDT(unsigned char vector, unsigned short segSelector, void(*isr)(), unsigned char dpl) {
    unsigned int offset = ((unsigned int) isr);
    idt[vector] = ((offset & 0xFFFF0000 | IDT_ATTR(dpl)));
    idt[vector] <<= 32;
    idt[vector] |= ((segSelector << 16) | (offset & 0x0000FFFF));
}

void initIDT() {
    setIDT(0, 0x08, asmIsr0, 0);
    setIDT(1, 0x08, asmIsr1, 0);
    setIDT(2, 0x08, asmIsr2, 0);
    setIDT(3, 0x08, asmIsr3, 0);
    setIDT(4, 0x08, asmIsr4, 0);
    setIDT(5, 0x08, asmIsr5, 0);
    setIDT(6, 0x08, asmIsr6, 0);
    setIDT(7, 0x08, asmIsr7, 0);
    setIDT(8, 0x08, asmIsr8, 0);
    setIDT(9, 0x08, asmIsr9, 0);
    setIDT(10, 0x08, asmIsr10, 0);
    setIDT(11, 0x08, asmIsr11, 0);
    setIDT(12, 0x08, asmIsr12, 0);
    setIDT(13, 0x08, asmIsr13, 0);
    setIDT(14, 0x08, asmIsr14, 0);
    setIDT(15, 0x08, asmIsr15, 0);
    setIDT(16, 0x08, asmIsr16, 0);
    setIDT(17, 0x08, asmIsr17, 0);
    setIDT(18, 0x08, asmIsr18, 0);
    setIDT(19, 0x08, asmIsr19, 0);
    setIDT(20, 0x08, asmIsr20, 0);
    setIDT(21, 0x08, asmIsr21, 0);
    setIDT(22, 0x08, asmIsr22, 0);
    setIDT(23, 0x08, asmIsr23, 0);
    setIDT(24, 0x08, asmIsr24, 0);
    setIDT(25, 0x08, asmIsr25, 0);
    setIDT(26, 0x08, asmIsr26, 0);
    setIDT(27, 0x08, asmIsr27, 0);
    setIDT(28, 0x08, asmIsr28, 0);
    setIDT(29, 0x08, asmIsr29, 0);
    setIDT(30, 0x08, asmIsr30, 0);
    setIDT(31, 0x08, asmIsr31, 0);
    setIDT(32, 0x08, asmIsr32, 0);
    setIDT(33, 0x08, asmIsr33, 0);
    setIDT(34, 0x08, asmIsr34, 0);
    setIDT(35, 0x08, asmIsr35, 0);
    setIDT(36, 0x08, asmIsr36, 0);
    setIDT(37, 0x08, asmIsr37, 0);
    setIDT(38, 0x08, asmIsr38, 0);
    setIDT(39, 0x08, asmIsr39, 0);
    setIDT(40, 0x08, asmIsr40, 0);
    setIDT(41, 0x08, asmIsr41, 0);
    setIDT(42, 0x08, asmIsr42, 0);
    setIDT(43, 0x08, asmIsr43, 0);
    setIDT(44, 0x08, asmIsr44, 0);
    setIDT(45, 0x08, asmIsr45, 0);
    setIDT(46, 0x08, asmIsr46, 0);
    setIDT(47, 0x08, asmIsr47, 0);
    setIDT(48, 0x08, asmIsr48, 0);
    setIDT(49, 0x08, asmIsr49, 0);
    setIDT(50, 0x08, asmIsr50, 0);
    setIDT(51, 0x08, asmIsr51, 0);
    setIDT(52, 0x08, asmIsr52, 0);
    setIDT(53, 0x08, asmIsr53, 0);
    setIDT(54, 0x08, asmIsr54, 0);
    setIDT(55, 0x08, asmIsr55, 0);
    setIDT(56, 0x08, asmIsr56, 0);
    setIDT(57, 0x08, asmIsr57, 0);
    setIDT(58, 0x08, asmIsr58, 0);
    setIDT(59, 0x08, asmIsr59, 0);
    setIDT(60, 0x08, asmIsr60, 0);
    setIDT(61, 0x08, asmIsr61, 0);
    setIDT(62, 0x08, asmIsr62, 0);
    setIDT(63, 0x08, asmIsr63, 0);
    setIDT(64, 0x08, asmIsr64, 0);
    setIDT(65, 0x08, asmIsr65, 0);
    setIDT(66, 0x08, asmIsr66, 0);
    setIDT(67, 0x08, asmIsr67, 0);
    setIDT(68, 0x08, asmIsr68, 0);
    setIDT(69, 0x08, asmIsr69, 0);
    setIDT(70, 0x08, asmIsr70, 0);
    setIDT(71, 0x08, asmIsr71, 0);
    setIDT(72, 0x08, asmIsr72, 0);
    setIDT(73, 0x08, asmIsr73, 0);
    setIDT(74, 0x08, asmIsr74, 0);
    setIDT(75, 0x08, asmIsr75, 0);
    setIDT(76, 0x08, asmIsr76, 0);
    setIDT(77, 0x08, asmIsr77, 0);
    setIDT(78, 0x08, asmIsr78, 0);
    setIDT(79, 0x08, asmIsr79, 0);
    setIDT(80, 0x08, asmIsr80, 0);
    setIDT(81, 0x08, asmIsr81, 0);
    setIDT(82, 0x08, asmIsr82, 0);
    setIDT(83, 0x08, asmIsr83, 0);
    setIDT(84, 0x08, asmIsr84, 0);
    setIDT(85, 0x08, asmIsr85, 0);
    setIDT(86, 0x08, asmIsr86, 0);
    setIDT(87, 0x08, asmIsr87, 0);
    setIDT(88, 0x08, asmIsr88, 0);
    setIDT(89, 0x08, asmIsr89, 0);
    setIDT(90, 0x08, asmIsr90, 0);
    setIDT(91, 0x08, asmIsr91, 0);
    setIDT(92, 0x08, asmIsr92, 0);
    setIDT(93, 0x08, asmIsr93, 0);
    setIDT(94, 0x08, asmIsr94, 0);
    setIDT(95, 0x08, asmIsr95, 0);
    setIDT(96, 0x08, asmIsr96, 0);
    setIDT(97, 0x08, asmIsr97, 0);
    setIDT(98, 0x08, asmIsr98, 0);
    setIDT(99, 0x08, asmIsr99, 0);
    setIDT(100, 0x08, asmIsr100, 0);
    setIDT(101, 0x08, asmIsr101, 0);
    setIDT(102, 0x08, asmIsr102, 0);
    setIDT(103, 0x08, asmIsr103, 0);
    setIDT(104, 0x08, asmIsr104, 0);
    setIDT(105, 0x08, asmIsr105, 0);
    setIDT(106, 0x08, asmIsr106, 0);
    setIDT(107, 0x08, asmIsr107, 0);
    setIDT(108, 0x08, asmIsr108, 0);
    setIDT(109, 0x08, asmIsr109, 0);
    setIDT(110, 0x08, asmIsr110, 0);
    setIDT(111, 0x08, asmIsr111, 0);
    setIDT(112, 0x08, asmIsr112, 0);
    setIDT(113, 0x08, asmIsr113, 0);
    setIDT(114, 0x08, asmIsr114, 0);
    setIDT(115, 0x08, asmIsr115, 0);
    setIDT(116, 0x08, asmIsr116, 0);
    setIDT(117, 0x08, asmIsr117, 0);
    setIDT(118, 0x08, asmIsr118, 0);
    setIDT(119, 0x08, asmIsr119, 0);
    setIDT(120, 0x08, asmIsr120, 0);
    setIDT(121, 0x08, asmIsr121, 0);
    setIDT(122, 0x08, asmIsr122, 0);
    setIDT(123, 0x08, asmIsr123, 0);
    setIDT(124, 0x08, asmIsr124, 0);
    setIDT(125, 0x08, asmIsr125, 0);
    setIDT(126, 0x08, asmIsr126, 0);
    setIDT(127, 0x08, asmIsr127, 0);
    setIDT(128, 0x08, asmIsr128, 0);
    setIDT(129, 0x08, asmIsr129, 0);
    setIDT(130, 0x08, asmIsr130, 0);
    setIDT(131, 0x08, asmIsr131, 0);
    setIDT(132, 0x08, asmIsr132, 0);
    setIDT(133, 0x08, asmIsr133, 0);
    setIDT(134, 0x08, asmIsr134, 0);
    setIDT(135, 0x08, asmIsr135, 0);
    setIDT(136, 0x08, asmIsr136, 0);
    setIDT(137, 0x08, asmIsr137, 0);
    setIDT(138, 0x08, asmIsr138, 0);
    setIDT(139, 0x08, asmIsr139, 0);
    setIDT(140, 0x08, asmIsr140, 0);
    setIDT(141, 0x08, asmIsr141, 0);
    setIDT(142, 0x08, asmIsr142, 0);
    setIDT(143, 0x08, asmIsr143, 0);
    setIDT(144, 0x08, asmIsr144, 0);
    setIDT(145, 0x08, asmIsr145, 0);
    setIDT(146, 0x08, asmIsr146, 0);
    setIDT(147, 0x08, asmIsr147, 0);
    setIDT(148, 0x08, asmIsr148, 0);
    setIDT(149, 0x08, asmIsr149, 0);
    setIDT(150, 0x08, asmIsr150, 0);
    setIDT(151, 0x08, asmIsr151, 0);
    setIDT(152, 0x08, asmIsr152, 0);
    setIDT(153, 0x08, asmIsr153, 0);
    setIDT(154, 0x08, asmIsr154, 0);
    setIDT(155, 0x08, asmIsr155, 0);
    setIDT(156, 0x08, asmIsr156, 0);
    setIDT(157, 0x08, asmIsr157, 0);
    setIDT(158, 0x08, asmIsr158, 0);
    setIDT(159, 0x08, asmIsr159, 0);
    setIDT(160, 0x08, asmIsr160, 0);
    setIDT(161, 0x08, asmIsr161, 0);
    setIDT(162, 0x08, asmIsr162, 0);
    setIDT(163, 0x08, asmIsr163, 0);
    setIDT(164, 0x08, asmIsr164, 0);
    setIDT(165, 0x08, asmIsr165, 0);
    setIDT(166, 0x08, asmIsr166, 0);
    setIDT(167, 0x08, asmIsr167, 0);
    setIDT(168, 0x08, asmIsr168, 0);
    setIDT(169, 0x08, asmIsr169, 0);
    setIDT(170, 0x08, asmIsr170, 0);
    setIDT(171, 0x08, asmIsr171, 0);
    setIDT(172, 0x08, asmIsr172, 0);
    setIDT(173, 0x08, asmIsr173, 0);
    setIDT(174, 0x08, asmIsr174, 0);
    setIDT(175, 0x08, asmIsr175, 0);
    setIDT(176, 0x08, asmIsr176, 0);
    setIDT(177, 0x08, asmIsr177, 0);
    setIDT(178, 0x08, asmIsr178, 0);
    setIDT(179, 0x08, asmIsr179, 0);
    setIDT(180, 0x08, asmIsr180, 0);
    setIDT(181, 0x08, asmIsr181, 0);
    setIDT(182, 0x08, asmIsr182, 0);
    setIDT(183, 0x08, asmIsr183, 0);
    setIDT(184, 0x08, asmIsr184, 0);
    setIDT(185, 0x08, asmIsr185, 0);
    setIDT(186, 0x08, asmIsr186, 0);
    setIDT(187, 0x08, asmIsr187, 0);
    setIDT(188, 0x08, asmIsr188, 0);
    setIDT(189, 0x08, asmIsr189, 0);
    setIDT(190, 0x08, asmIsr190, 0);
    setIDT(191, 0x08, asmIsr191, 0);
    setIDT(192, 0x08, asmIsr192, 0);
    setIDT(193, 0x08, asmIsr193, 0);
    setIDT(194, 0x08, asmIsr194, 0);
    setIDT(195, 0x08, asmIsr195, 0);
    setIDT(196, 0x08, asmIsr196, 0);
    setIDT(197, 0x08, asmIsr197, 0);
    setIDT(198, 0x08, asmIsr198, 0);
    setIDT(199, 0x08, asmIsr199, 0);
    setIDT(200, 0x08, asmIsr200, 0);
    setIDT(201, 0x08, asmIsr201, 0);
    setIDT(202, 0x08, asmIsr202, 0);
    setIDT(203, 0x08, asmIsr203, 0);
    setIDT(204, 0x08, asmIsr204, 0);
    setIDT(205, 0x08, asmIsr205, 0);
    setIDT(206, 0x08, asmIsr206, 0);
    setIDT(207, 0x08, asmIsr207, 0);
    setIDT(208, 0x08, asmIsr208, 0);
    setIDT(209, 0x08, asmIsr209, 0);
    setIDT(210, 0x08, asmIsr210, 0);
    setIDT(211, 0x08, asmIsr211, 0);
    setIDT(212, 0x08, asmIsr212, 0);
    setIDT(213, 0x08, asmIsr213, 0);
    setIDT(214, 0x08, asmIsr214, 0);
    setIDT(215, 0x08, asmIsr215, 0);
    setIDT(216, 0x08, asmIsr216, 0);
    setIDT(217, 0x08, asmIsr217, 0);
    setIDT(218, 0x08, asmIsr218, 0);
    setIDT(219, 0x08, asmIsr219, 0);
    setIDT(220, 0x08, asmIsr220, 0);
    setIDT(221, 0x08, asmIsr221, 0);
    setIDT(222, 0x08, asmIsr222, 0);
    setIDT(223, 0x08, asmIsr223, 0);
    setIDT(224, 0x08, asmIsr224, 0);
    setIDT(225, 0x08, asmIsr225, 0);
    setIDT(226, 0x08, asmIsr226, 0);
    setIDT(227, 0x08, asmIsr227, 0);
    setIDT(228, 0x08, asmIsr228, 0);
    setIDT(229, 0x08, asmIsr229, 0);
    setIDT(230, 0x08, asmIsr230, 0);
    setIDT(231, 0x08, asmIsr231, 0);
    setIDT(232, 0x08, asmIsr232, 0);
    setIDT(233, 0x08, asmIsr233, 0);
    setIDT(234, 0x08, asmIsr234, 0);
    setIDT(235, 0x08, asmIsr235, 0);
    setIDT(236, 0x08, asmIsr236, 0);
    setIDT(237, 0x08, asmIsr237, 0);
    setIDT(238, 0x08, asmIsr238, 0);
    setIDT(239, 0x08, asmIsr239, 0);
    setIDT(240, 0x08, asmIsr240, 0);
    setIDT(241, 0x08, asmIsr241, 0);
    setIDT(242, 0x08, asmIsr242, 0);
    setIDT(243, 0x08, asmIsr243, 0);
    setIDT(244, 0x08, asmIsr244, 0);
    setIDT(245, 0x08, asmIsr245, 0);
    setIDT(246, 0x08, asmIsr246, 0);
    setIDT(247, 0x08, asmIsr247, 0);
    setIDT(248, 0x08, asmIsr248, 0);
    setIDT(249, 0x08, asmIsr249, 0);
    setIDT(250, 0x08, asmIsr250, 0);
    setIDT(251, 0x08, asmIsr251, 0);
    setIDT(252, 0x08, asmIsr252, 0);
    setIDT(253, 0x08, asmIsr253, 0);
    setIDT(254, 0x08, asmIsr254, 0);
    setIDT(255, 0x08, asmIsr255, 0);
}
